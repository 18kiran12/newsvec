from tokenize import String
from transformers import PegasusForConditionalGeneration, PegasusTokenizer, PegasusConfig, PegasusModel
import torch
import pdb

# model_name = "./pegasus-newsroom"
# # config = PegasusConfig.from_pretrained("./pegasus-newsroom/config.json")
# model = PegasusForConditionalGeneration.from_pretrained(model_name)
# tokenizer = PegasusTokenizer.from_pretrained(model_name)
# src_text = ["Protein is made up of amino acids that act as building blocks for cells and tissues in the body. There are 20 amino acids that combine to form proteins. While some can be synthesized by the human body, others cannot. The nine amino acids that the body cannot make are called essential amino acids. These must be obtained through diet. When a person eats protein, it is digested and broken down into amino acids, which are involved in many processes in the body, including tissue growth and repair, immune function, and energy production. Like other body tissues, muscle proteinsTrusted Source are continuously broken down and rebuilt. In order to build muscle, a person must consume more protein than what is broken down. This is often referred to as a net positive nitrogen balance, as protein is high in nitrogen. If a person is not consuming adequate amounts of protein, their body tends to break down muscleTrusted Source to provide the body with the amino acids needed to support body functions and preserve more important tissues. Over time, this can lead to decreased muscle mass and strength. Lastly, the body uses amino acids for muscle protein synthesis (MPS), the primary driver of muscle repair, recovery, and growth after strenuous exercises. How much protein do you need. According to the 2020-2025 Dietary Guidelines for AmericansTrusted Source, most healthy adults over 19 years old should get between 10-35 of their daily calories from protein. One gram of protein provides 4 calories.This means that a person who eats 2,000 calories per day would need to consume between 50 and 175 grams of protein per day. The current RDA of 0.8 g per kg of body weight for protein is based on the amount required to maintain nitrogen balance and prevent muscle loss. However, extending these recommendations to active individuals who are looking to build muscle may not be appropriate. When it comes to building muscle mass, the ideal amount of daily protein a person should consume varies depending on several factors, including age, gender, activity level, health, and other variables."]

# batch = tokenizer(src_text, truncation=True, padding="longest", return_tensors="pt")
# translated = model.generate(**batch, output_hidden_states = True, return_dict_in_generate=True, output_scores=True)
# tgt_text = tokenizer.batch_decode(translated, skip_special_tokens=True)

def get_embedding(data : list):
    model_name = "./pegasus-newsroom"
    config = PegasusConfig.from_pretrained("./pegasus-newsroom/config.json")
    model = PegasusForConditionalGeneration.from_pretrained(model_name,  output_hidden_states=True)
    tokenizer = PegasusTokenizer.from_pretrained(model_name)
    embeddings = []
    for text in data:
        batch = tokenizer(text, truncation=True, padding="longest", return_tensors="pt")
        # print(text)
        translated = model.generate(batch["input_ids"])
        # print(translated)
        # summary_words = tokenizer.batch_decode(translated, skip_special_tokens=True, clean_up_tokenization_spaces=False)[0]
        pdb.set_trace()
        print(tokenizer.decode(translated[0]))
        embeddings.append(translated.decoder_hidden_states[-1][-1].squeeze().mean(dim=0)) # last layer mebeddings summed over multiple beam search
    return embeddings

# tensors = get_embedding(["The tower is 324 metres (1,063 ft) tall, about the same height as an 81-storey building, and the tallest structure in Paris. Its base is square, measuring 125 metres (410 ft) on each side. During its construction, the Eiffel Tower surpassed the Washington Monument to become the tallest man-made structure in the world, a title it held for 41 years until the Chrysler Building in New York City was finished in 1930. It was the first structure to reach a height of 300 metres. Due to the addition of a broadcasting aerial at the top of the tower in 1957, it is now taller than the Chrysler Building by 5.2 metres (17 ft). Excluding transmitters, the Eiffel Tower is the second tallest free-standing structure in France after the Millau Viaduct."])


tensors = get_embedding(["For Immediate Release: October 20, 2021\n\nEspañol\n\nToday, the U.S. Food and Drug Administration took action to expand the use of a booster dose for COVID-19 vaccines in eligible populations. The agency is amending the emergency use authorizations (EUA) for COVID-19 vaccines to allow for the use of a single booster dose as follows:\n\nThe use of a single booster dose of the Moderna COVID-19 Vaccine that may be administered at least 6 months after completion of the primary series to individuals: 65 years of age and older 18 through 64 years of age at high risk of severe COVID-19 18 through 64 years of age with frequent institutional or occupational exposure to SARS-CoV-2\n\nThe use of a single booster dose of the Janssen (Johnson and Johnson) COVID-19 Vaccine may be administered at least 2 months after completion of the single-dose primary regimen to individuals 18 years of age and older.\n\nThe use of each of the available COVID-19 vaccines as a heterologous (or “mix and match”) booster dose in eligible individuals following completion of primary vaccination with a different available COVID-19 vaccine.\n\nTo clarify that a single booster dose of the Pfizer-BioNTech COVID-19 Vaccine may be administered at least 6 months after completion of the primary series to individuals 18 through 64 years of age with frequent institutional or occupational exposure to SARS-CoV-2.\n\n“Today’s actions demonstrate our commitment to public health in proactively fighting against the COVID-19 pandemic,” said Acting FDA Commissioner Janet Woodcock, M.D. “As the pandemic continues to impact the country, science has shown that vaccination continues to be the safest and most effective way to prevent COVID-19, including the most serious consequences of the disease, such as hospitalization and death. The available data suggest waning immunity in some populations who are fully vaccinated. The availability of these authorized boosters is important for continued protection against COVID-19 disease.”\n\n“The amendments to the emergency use authorizations to include a single booster dose in eligible populations are based on the available data and information and follows the input from the members of our advisory committee who were supportive of the use of a booster dose of these vaccines in eligible populations,” said Peter Marks, M.D., Ph.D., director of the FDA’s Center for Biologics Evaluation and Research. “We are also taking action today to include the use of mix and match boosters to address this public health need. We will work to accrue additional data as quickly as possible to further assess the benefits and risks of the use of booster doses in additional populations and plan to update the healthcare community and public with our determination in the coming weeks.”\n\nAuthorization of Moderna COVID-19 Vaccine Booster Dose\n\nTo support the authorization for emergency use of a single booster dose of the Moderna COVID-19 Vaccine, the FDA analyzed immune response data from 149 participants 18 years of age and older from the original clinical studies who received a booster dose at least 6 months after their second dose and compared it to the immune responses of 1,055 study participants after completing their two-dose series. The antibody response of the 149 participants against SARS-CoV-2 virus 29 days after a booster dose of the vaccine demonstrated a booster response.\n\nThe FDA also evaluated an additional analysis from Moderna comparing the rates of COVID-19 accrued during the Delta variant surge during July and August 2021, which suggest that there is a waning of vaccine effectiveness over time.\n\nSafety was evaluated in 171 participants 18 years of age and older who were followed for an average of approximately six months. The most commonly reported side effects by the clinical trial participants who received the booster dose of the vaccine were pain at the injection site, tiredness, headache, muscle and/or joint pain, chills, swollen lymph nodes in same arm as the injection, nausea and vomiting, and fever. Of note, swollen lymph nodes in the underarm were observed more frequently following the booster dose than after the primary two-dose series.\n\nOngoing analyses from the FDA and the Centers for Disease Control and Prevention (CDC) safety surveillance systems have identified increased risks of inflammatory heart conditions, myocarditis and pericarditis, following vaccination with the Moderna COVID-19 vaccine, particularly following the second dose. Typically, onset of symptoms has been a few days following vaccination. The observed risk is higher among males under 40 years of age, particularly males 18 through 24, than among females and older males.\n\nThe Moderna COVID-19 single booster dose is half of the dose that is administered for a primary series dose and is administered at least six months after completion of a primary series of the vaccine.\n\nAuthorization of Janssen (Johnson and Johnson) COVID-19 Vaccine Booster Dose\n\nThe authorization for emergency use of a single booster dose of the Janssen COVID-19 Vaccine is based on the FDA’s evaluation of immune response data in 39 participants from a clinical trial including 24 participants who were 18 through 55 years of age and 15 participants who were 65 years of age and older. The study participants received a booster dose approximately 2 months after their first dose, and the results demonstrated a booster response.\n\nOverall, approximately 9,000 clinical trial participants have received two doses of Janssen COVID-19 Vaccine administered at least two months apart and of these, approximately 2,700 have had at least two months of safety follow-up after the booster dose. Janssen’s safety analyses from these studies have not identified new safety concerns.\n\nEarlier analyses from the FDA and CDC safety surveillance systems suggest an increased risk of a serious and rare type of blood clot in combination with low blood platelets following administration of the Janssen COVID-19 vaccine. This serious condition is called thrombocytopenia syndrome (TTS). People who developed TTS after receiving the vaccine had symptoms that began about one to two weeks after vaccination. Reporting of TTS has been highest in females ages 18 through 49 years. In addition, safety surveillance suggests an increased risk of a specific serious neurological disorder called Guillain Barré syndrome, within 42 days following receipt of the Janssen COVID-19 Vaccine.\n\nAuthorization of “Mix and Match” Booster Dose\n\nToday, the FDA is also authorizing the use of heterologous (or “mix and match”) booster dose for currently available (i.e., FDA-authorized or approved) COVID-19 vaccines. Following a presentation of clinical trial data from the National Institute of Allergy and Infectious Diseases, the Vaccines and Related Biological Products Advisory Committee’s discussion of information submitted for consideration, along with the agency’s evaluation of the available data, the FDA has determined that the known and potential benefits of the use of a single heterologous booster dose outweigh the known and potential risks of their use in eligible populations.\n\nA single booster dose of any of the available COVID-19 vaccines may be administered as a heterologous booster dose following completion of primary vaccination with a different available COVID-19 vaccine. The eligible population(s) and dosing interval for a heterologous booster dose are the same as those authorized for a booster dose of the vaccine used for primary vaccination.\n\nFor example, Janssen COVID-19 Vaccine recipients 18 years of age and older may receive a single booster dose of Janssen COVID-19 Vaccine, Moderna COVID-19 Vaccine (half dose) or Pfizer-BioNTech COVID-19 Vaccine at least two months after receiving their Janssen COVID-19 Vaccine primary vaccination.\n\nIn another example, Moderna COVID-19 Vaccine and Pfizer-BioNTech COVID-19 vaccine recipients falling into one of the authorized categories for boosters (65 years of age and older, 18 through 64 years of age at high-risk of severe COVID-19, and 18 through 64 years of age with frequent institutional or occupational exposure to SARS-CoV-2) may receive a booster dose of Moderna COVID-19 Vaccine (half dose), Pfizer-BioNTech COVID-19 Vaccine or Janssen COVID-19 Vaccine at least six months after completing their primary vaccination.\n\nThe agency recognizes that health care providers and COVID-19 vaccine recipients will have questions about booster doses. The individual fact sheets for each available vaccine provide relevant information for health care providers and the vaccine recipients. The agency encourages health care providers to also follow the recommendations that will be provided by the CDC following a meeting of their Advisory Committee on Immunization Practices and formal recommendations signed by the CDC director.\n\nRelated Information\n\n###\n\nBoilerplate The FDA, an agency within the U.S. Department of Health and Human Services, protects the public health by assuring the safety, effectiveness, and security of human and veterinary drugs, vaccines and other biological products for human use, and medical devices. The agency also is responsible for the safety and security of our nation’s food supply, cosmetics, dietary supplements, products that give off electronic radiation, and for regulating tobacco products."])

print(tensors)

# torch.save(tensors, 'tensors.pt')